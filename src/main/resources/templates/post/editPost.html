<!DOCTYPE html>
<html lang="en">
<head>
    <title>게시물 수정</title>
    <script>
        // 페이지 로딩이 완료되면 실행
        window.addEventListener('load', async () => {
            // 현재 URL에서 게시물 ID 추출
            const pathArray = window.location.pathname.split('/');
            const postId = pathArray[pathArray.length - 1];

            // 기존 데이터 불러오기
            const response = await fetch(`/api/posts/${postId}`);
            const post = await response.json();

            // 폼에 데이터 채우기
            document.getElementById('title').value = post.post_title;
            document.getElementById('content').value = post.contents;
        });

        // 수정 버튼을 클릭하면 실행되는 함수
        async function editPost() {
            // 현재 URL에서 게시물 ID 추출
            const pathArray = window.location.pathname.split('/');
            const postId = pathArray[pathArray.length - 1];

            const title = document.getElementById('title').value;
            const content = document.getElementById('content').value;

            // 수정 API 호출
            const response = await fetch(`/api/posts/edit/${postId}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    title: title,
                    content: content
                })
            });

            if (response.ok) {
                alert('게시물이 수정되었습니다.');
                window.location.href = `/posts/view/${postId}`;
            } else {
                alert('게시물 수정에 실패했습니다.');
            }
        }
    </script>
</head>
<body>
<h1>게시물 수정</h1>

<div class="form-group">

    <label for="title">제목:</label><br>
    <input type="text" id="title" name="title" required><br><br>

    <label for="content">내용:</label><br>
    <textarea id="content" name="content" rows="4" cols="50" required></textarea><br><br>

</div>
<button onclick="editPost()">수정하기</button>
</body>
</html>
